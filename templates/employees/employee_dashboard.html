{% extends "employees/sidebar.html" %}

{% block content %}

<div class="container-fluid">

    <h2 class="mb-4">
    Welcome back, <span class="text-primary">
        {{ session.get('username','Employee') }}
    </span>
</h2>

    <!-- Cards Row -->
   <!-- Stats Section -->
<div class="row mb-4">

    <!-- Completed -->
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon" 
                 style="background: linear-gradient(135deg, #86efac, #16a34a); color:white;">
                <i class="fas fa-check-circle"></i>
            </div>
            <span class="stat-label">Completed Tasks</span>
            <span class="stat-value">{{ completed_tasks }}</span>
        </div>
    </div>

    <!-- In Progress -->
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon"
                 style="background: linear-gradient(135deg, #fde68a, #f59e0b); color:white;">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <span class="stat-label">In Progress</span>
            <span class="stat-value">{{ in_progress_tasks }}</span>
        </div>
    </div>

    <!-- To Do -->
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon"
                 style="background: linear-gradient(135deg, #fca5a5, #dc2626); color:white;">
                <i class="fas fa-list-check"></i>
            </div>
            <span class="stat-label">To Do Tasks</span>
            <span class="stat-value">{{ todo_tasks }}</span>
        </div>
    </div>

    <!-- Projects -->
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-icon" 
                 style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color:white;">
                <i class="fas fa-folder"></i>
            </div>
            <span class="stat-label">Projects</span>
            <span class="stat-value">{{ project_count }}</span>
        </div>
    </div>

</div>

    <!-- Charts Row -->
    <div class="row">

        <!-- Weekly Line Chart -->
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header">
                    Weekly Performance
                </div>
                <div class="card-body" style="height: 320px;">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Doughnut Chart -->
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header">
                    Task Distribution
                </div>
                <div class="card-body" style="height: 320px;">
                    <canvas id="taskChart"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- Chart JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Doughnut Chart
    const taskCtx = document.getElementById('taskChart');

    new Chart(taskCtx, {
        type: 'doughnut',
        data: {
            labels: ['Completed', 'In Progress', 'To Do'],
            datasets: [{
                data: [
                    {{ completed_tasks }},
                    {{ in_progress_tasks }},
                    {{ todo_tasks }}
                ],
                backgroundColor: [
                    '#14B8A6',
                    '#FDE68A',
                    '#A5B4FC'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // Weekly Line Chart
    const weeklyCtx = document.getElementById('weeklyChart');

    new Chart(weeklyCtx, {
        type: 'line',
        data: {
            labels: {{ weekly_labels | tojson }},
            datasets: [{
                label: 'Tasks Completed',
                data: {{ weekly_values | tojson }},
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13,110,253,0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    
</script>

{% endblock %}